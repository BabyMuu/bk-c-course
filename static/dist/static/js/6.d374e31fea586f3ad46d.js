(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{115:function(e,t,i){"use strict";i.r(t);var n=i(116);var a=i.n(n);for(var s in n)if(s!=="default")(function(e){i.d(t,e,function(){return n[e]})})(s);t["default"]=a.a},116:function(e,t,i){"use strict";var n=i(0);Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var a=n(i(15));var s=n(i(16));var r=n(i(148));var o=n(i(149));var u=n(i(150));var c=n(i(151));var l=n(i(152));var h=n(i(171));var p=n(i(173));var d={name:"set_question_detail",components:{QuestionRadio:r.default,QuestionMulti:o.default,QuestionJudge:u.default,QuestionShort:c.default,QuestionFill:l.default,ChapterManage:h.default,QuestionImport:p.default},data:function e(){return{editQuestion:{visable:false,Question:null},pagination:{current:1,count:500,limit:10},config:{message:null,theme:"error",offset:80},Dict:{SINGLE:"QuestionRadio",MULTIPLE:"QuestionMulti",COMPLETION:"QuestionFill",JUDGE:"QuestionJudge",SHORT_ANSWER:"QuestionShort"},componentKey:0,componentKey1:0,componentKey2:0,curChapter:[],curChapterId:null,chapterFilters:[],chapterList:[],selection:[],questionList:[],showQuestionList:[],panels:[{name:"QuestionImport",label:"批量导入",count:10},{name:"QuestionRadio",label:"单选题",count:20},{name:"QuestionMulti",label:"多选题",count:30},{name:"QuestionJudge",label:"判断题",count:40},{name:"QuestionFill",label:"填空题",count:50},{name:"QuestionShort",label:"简答题",count:60}],active:"QuestionImport"}},computed:{curType:function e(){if(this.active==="QuestionRadio"){return["SINGLE"]}else if(this.active==="QuestionMulti"){return["MULTIPLE"]}else if(this.active==="QuestionJudge"){return["JUDGE"]}else if(this.active==="QuestionFill"){return["COMPLETION"]}else if(this.active==="QuestionShort"){return["SHORT_ANSWER"]}else{return[]}},courseId:function e(){return this.$store.state.currentCourseId},showQuestionList1:function e(){var t=Math.ceil(this.pagination.count/this.pagination.limit);var i=(this.pagination.current-1)*this.pagination.limit;return this.pagination.current===t?this.showQuestionList.slice(i,i+this.pagination.limit):this.showQuestionList.slice(i,i+this.pagination.limit)}},watch:{courseId:function e(t,i){this.getChapterList()},questionList:function e(t,i){var n=this;this.showQuestionList=t;if(this.curType.length>0){var a=[];this.questionList.forEach(function(e){if(e.types===n.curType[0]){a.push(e)}});this.showQuestionList=a;this.pagination.count=a.length}else{this.pagination.count=this.questionList.length}this.pagination.current=1}},created:function e(){this.getChapterList();this.componentKey1=this.componentKey1+1},methods:{getChapterList:function e(){var t=this;return(0,s.default)(a.default.mark(function e(){return a.default.wrap(function e(i){while(1){switch(i.prev=i.next){case 0:t.$http.get("/course/get_chapter_list/",{params:{course_id:t.courseId}}).then(function(e){t.chapterList=e.data;t.chapterFilters=[];t.chapterList.forEach(function(e){t.chapterFilters.push({text:e.chapter_name,value:e.id})});t.curChapterId=null;t.getQuestionList()});case 1:case"end":return i.stop()}}},e)}))()},operateChapter:function e(t){var i=this;return(0,s.default)(a.default.mark(function e(){return a.default.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:i.$http.post("/course/operate_chapter/",{course_id:i.courseId,chapter_list:t}).then(function(e){if(e.result){i.config.theme="success";i.config.message="修改成功！";i.$bkMessage(i.config)}else{i.config.theme="error";i.config.message=e.message;i.$bkMessage(i.config)}i.getChapterList()});case 1:case"end":return n.stop()}}},e)}))()},getQuestionList:function e(){var t=this;return(0,s.default)(a.default.mark(function e(){return a.default.wrap(function e(i){while(1){switch(i.prev=i.next){case 0:t.$http.get("/course/get_question_list/",{params:{course_id:t.courseId,chapter_id:t.curChapterId}}).then(function(e){t.questionList=e.data;t.componentKey=t.componentKey+1});case 1:case"end":return i.stop()}}},e)}))()},setQuestion:function e(t,i){var n=this;return(0,s.default)(a.default.mark(function e(){return a.default.wrap(function e(a){while(1){switch(a.prev=a.next){case 0:if(t==="append"){if(n.curChapterId){n.$http.post("/course/teacher_set_question/",{course_id:n.courseId,question:i.question,chapter_id:n.curChapterId,types:i.types,option_A:i.option_A,option_B:i.option_B,option_C:i.option_C,option_D:i.option_D,option_E:i.option_E,answer:i.answer,explain:i.explain}).then(function(e){if(e.result){n.config.theme="success";n.config.message="上传成功！"}else{n.config.theme="error";n.config.message=e.message}n.$bkMessage(n.config);n.componentKey2=n.componentKey2+1;n.getQuestionList()})}else{n.config.theme="error";n.config.message="章节为空！先选择章节再进行出题";n.$bkMessage(n.config)}}else if(t==="delete"){if(i.length>0){n.$http.delete("/course/teacher_set_question/",{params:{course_id:n.courseId,question_id_list:JSON.stringify(i)}}).then(function(e){if(e.result){n.config.theme="success";n.config.message="删除成功！"}else{n.config.theme="error";n.config.message=e.message}n.$bkMessage(n.config);n.getQuestionList()})}}else if(t==="update"){n.$http.put("/course/teacher_set_question/",{course_id:n.courseId,question_id:i.question_id,question:i.question,types:i.types,option_A:i.option_A,option_B:i.option_B,option_C:i.option_C,option_D:i.option_D,option_E:i.option_E,answer:i.answer,explain:i.explain}).then(function(e){if(e.result){n.config.theme="success";n.config.message="修改成功！"}else{n.config.theme="error";n.config.message=e.message}n.$bkMessage(n.config);n.getQuestionList();n.editQuestion.visable=false})}case 1:case"end":return a.stop()}}},e)}))()},createQuestion:function e(t){this.setQuestion("append",t)},filterType:function e(t,i){return i.types===t},filterChapter:function e(t,i){return i.chapter_id===t},filterHandler:function e(t,i,n){var a=n["property"];return i[a]===t},handleSelectChange:function e(t,i){this.selection=t},handleFilterChange:function e(t){var i=this;var n=[];for(var a in t){n=t[a]}if(n.length>0){var s=[];n.forEach(function(e){i.questionList.forEach(function(t){if(t.types===e){s.push(t)}})});this.showQuestionList=s;this.pagination.count=s.length}else{this.showQuestionList=this.questionList;this.pagination.count=this.questionList.length}},handleRowClick:function e(t,i,n,a,s){if(s!==4){this.editQuestion.Question=t;this.editQuestion.visable=true}},handleTabChange:function e(t){var i=this;this.componentKey+=1;var n=[];if(this.curType.length>0){this.questionList.forEach(function(e){if(e.types===i.curType[0]){n.push(e)}});this.showQuestionList=n;this.pagination.count=this.showQuestionList.length}else{this.showQuestionList=this.questionList;this.pagination.count=this.questionList.length}this.pagination.current=1},handleSelected:function e(t,i){this.getQuestionList();this.curChapter=[];this.curChapter.push(t);this.curChapterid=t;this.componentKey+=1},handleChapterClear:function e(t){this.curChapterid=null;this.getQuestionList()},deleteQuestion:function e(t){var i=[];i.push(t.question_id);this.setQuestion("delete",i)},deleteQuestions:function e(t){var i=[];this.selection.forEach(function(e){i.push(e.question_id)});this.setQuestion("delete",i)},ToManageChapter:function e(){this.$router.push({name:"manage_chapter_index"})},updateChapter:function e(t,i){if(i){this.operateChapter(t)}else{this.componentKey1=this.componentKey1+1}},updateQuestion:function e(t){this.setQuestion("update",t)},questionType:function e(t){if(t==="SINGLE"){return"单选题"}else if(t==="MULTIPLE"){return"多选题"}else if(t==="JUDGE"){return"判断题"}else if(t==="COMPLETION"){return"填空题"}else if(t==="SHORT_ANSWER"){return"简答题"}else{return[]}},handlePageChange:function e(t){this.pagination.current=t},handlePageLimitChange:function e(t){this.pagination.current=1;this.pagination.limit=t}}};t.default=d},132:function(e,t,i){"use strict";i.r(t);var n=i(133);var a=i.n(n);for(var s in n)if(s!=="default")(function(e){i.d(t,e,function(){return n[e]})})(s);t["default"]=a.a},133:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n={name:"ChapterManage",props:{chapters:{type:Object,default:function e(){return{}}},chapterid:{type:Number,default:-1}},data:function e(){return{config:{message:null,theme:"error",offset:80},rules:{chapter:[{required:true,message:"章节不能为空",trigger:"change"}]},show:false,editable:false,curRow:null,curChapter:null,changed:false,saved:false,append:{appendText:null,appendNumber:0},selection:[]}},computed:{chapterList:function e(){return JSON.parse(JSON.stringify(this.chapters))}},watch:{},created:function e(){},methods:{handleRowDbclick:function e(t,i,n,a,s){var r=this;if(!t.id){t.id="focus"}this.curRow=t.id;this.curChapter=t.chapter_name;this.editable=!this.editable;this.$nextTick(function(){r.$refs.myinput.focus()})},handleEnter:function e(t){if(t.id==="focus"){t.id=null}this.editable=false},handleBlur:function e(t){if(t.id==="focus"){t.id=null}if(!t.chapter_name||this.repeated(this.chapterList,"chapter_name",t.chapter_name)>1){t.chapter_name=this.curChapter}this.editable=false},handleHidden:function e(){this.editable=false;this.$emit("updateChapter",this.chapterList,this.saved)},handleShown:function e(){},rowEditable:function e(t){return t===this.curRow&&this.editable},chapterManage:function e(){this.show=true},saveChange:function e(){this.saved=true;if(this.changed){this.$emit("updateChapter",this.chapterList,this.saved)}else{this.compare();if(this.changed){this.$emit("updateChapter",this.chapterList,this.saved)}else{this.config.theme="warning";this.config.message="未做修改";this.$bkMessage(this.config)}}this.saved=false;this.changed=false},appendChapter:function e(){var t=this;if(this.repeated(this.chapterList,"chapter_name",this.append.appendText)>0){this.config.theme="warning";this.config.message="此章节已存在，不可重复添加";this.$bkMessage(this.config)}else{this.$refs.appendChapter.validate().then(function(e){t.chapterList.push({id:null,chapter_name:t.append.appendText});t.append.appendText=null;t.append.appendNumber=t.append.appendNumber+1},function(e){t.config.theme="warning";t.config.message=e.content;t.$bkMessage(t.config)});this.$refs.appendInput.focus();this.changed=true}},handleSelectChange:function e(t,i){this.selection=t},deleteChapter:function e(t){if(t.id===null||t.id==="focus"){this.append.appendNumber=this.append.appendNumber-1;if(this.append.appendNumber!==0){this.changed=true}else if(this.changed){this.changed=false}}else{this.changed=true}this.chapterList.splice(this.chapterList.indexOf(t),1)},compare:function e(){for(var t=0;t<this.chapterList.length;t++){if(this.chapterList[t].id!==this.chapters[t].id||this.chapterList[t].chapter_name!==this.chapters[t].chapter_name){this.changed=true}}},repeated:function e(t,i,n){var e=0;t.forEach(function(t){if(t[i]===n){e=e+1}});return e},tableRowStyle:function e(t){var i=t.row,n=t.rowIndex;if(i.id===this.chapterid){var a={"background-color":"#E1ECFF"};return a}}}};t.default=n},134:function(e,t,i){},135:function(e,t,i){"use strict";i.r(t);var n=i(136);var a=i.n(n);for(var s in n)if(s!=="default")(function(e){i.d(t,e,function(){return n[e]})})(s);t["default"]=a.a},136:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n={name:"QuestionImport",props:{chapterid:{type:Number,default:null}},data:function e(){return{config:{message:null,theme:"error",offset:80}}},methods:{downtemplete:function e(){var t=this;var i=document.createElement("a");this.$http.get("/course/download_set_question_excel_template_url/").then(function(e){if(e.result){i.href=e.url;i.click()}else{t.$bkMessage({message:"下载失败请重新尝试",delay:1e3,theme:"error",offsetY:60,ellipsisLine:2})}})},handleRes:function e(t){if(t.id){return true}return false},addExcel:function e(t){var i=this;if(this.chapterid){var n=new FormData;n.append("excel_file",t.fileList[0].origin);n.append("course_id",this.$store.state.currentCourseId);n.append("chapter_id",this.chapterid);n.append("is_file",true);var a={headers:{"Content-Type":"multipart/form-data"}};this.$http.post("/course/import_question_excel/",n,a).then(function(e){if(e.result){i.config.theme="success";i.config.message=e.message;i.$bkMessage(i.config);i.$emit("importQuestionExcel")}else{i.config.theme="error";i.config.message=e.message;i.$bkMessage(i.config)}})}else{this.config.theme="error";this.config.message="章节不能为空！";this.$bkMessage(this.config)}}}};t.default=n},137:function(e,t,i){},138:function(e,t,i){},171:function(e,t,i){"use strict";i.r(t);var n=i(198);var a=i(132);for(var s in a)if(s!=="default")(function(e){i.d(t,e,function(){return a[e]})})(s);var r=i(172);var o=i(2);var u=Object(o["a"])(a["default"],n["a"],n["b"],false,null,"43a8a86c",null);t["default"]=u.exports},172:function(e,t,i){"use strict";var n=i(134);var a=i.n(n);var s=a.a},173:function(e,t,i){"use strict";i.r(t);var n=i(199);var a=i(135);for(var s in a)if(s!=="default")(function(e){i.d(t,e,function(){return a[e]})})(s);var r=i(174);var o=i(2);var u=Object(o["a"])(a["default"],n["a"],n["b"],false,null,"53b5956a",null);t["default"]=u.exports},174:function(e,t,i){"use strict";var n=i(137);var a=i.n(n);var s=a.a},175:function(e,t,i){"use strict";var n=i(138);var a=i.n(n);var s=a.a},190:function(e,t,i){"use strict";var n=function(){var e=this;var t=e.$createElement;var i=e._self._c||t;return i("div",{staticClass:"create_question"},[i("div",[i("bk-select",{staticStyle:{width:"25%",display:"inline-block"},attrs:{disabled:false,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",searchable:"",placeholder:"请选择章节"},on:{selected:e.handleSelected,change:e.handleChapterChange,clear:e.handleChapterClear},model:{value:e.curChapterId,callback:function(t){e.curChapterId=t},expression:"curChapterId"}},e._l(e.chapterList,function(e){return i("bk-option",{key:e.id,attrs:{id:e.id,name:e.chapter_name}})}),1),e._v(" "),i("chapter-manage",{key:e.componentKey1,attrs:{chapters:e.chapterList,chapterid:e.curChapterId},on:{updateChapter:e.updateChapter}})],1),e._v(" "),i("div",{staticClass:"set_question",staticStyle:{height:"480px","margin-bottom":"30px"}},[i("bk-tab",{attrs:{active:e.active,type:"border-card","label-height":"50","active-bar":e.activeBar2},on:{"update:active":function(t){e.active=t},"tab-change":e.handleTabChange}},e._l(e.panels,function(t,n){return i("bk-tab-panel",e._b({key:n,staticStyle:{height:"396px"}},"bk-tab-panel",t,false),[i("keep-alive",{key:e.componentKey2},[i(e.active,{tag:"component",attrs:{chapterid:e.curChapterId},on:{createQuestion:e.createQuestion,importQuestionExcel:function(t){e.getQuestionList()}}})],1)],1)}),1)],1),e._v(" "),i("bk-dialog",{attrs:{width:"1200",draggable:false,"show-footer":false},model:{value:e.editQuestion.visable,callback:function(t){e.$set(e.editQuestion,"visable",t)},expression:"editQuestion.visable"}},[e.editQuestion.visable?i(e.Dict[e.editQuestion.Question.types],{tag:"component",attrs:{info:e.editQuestion.Question,editable:true},on:{updateQuestion:e.updateQuestion}}):e._e()],1),e._v(" "),i("div",{staticClass:"questions"},[i("bk-button",{staticStyle:{"margin-bottom":"10px"},attrs:{theme:"primary",outline:true},on:{click:e.deleteQuestions}},[e._v("批量删除")]),e._v(" "),i("bk-table",{key:e.componentKey,attrs:{data:e.showQuestionList1,size:e.size,"outer-border":true,"virtual-render":true,pagination:e.pagination,"highlight-current-row":true,height:"500"},on:{"filter-change":e.handleFilterChange,"selection-change":e.handleSelectChange,"page-change":e.handlePageChange,"page-limit-change":e.handlePageLimitChange,"row-click":e.handleRowClick}},[i("bk-table-column",{attrs:{type:"selection",width:60},model:{value:e.selection,callback:function(t){e.selection=t},expression:"selection"}}),e._v(" "),i("bk-table-column",{attrs:{label:"题目id",prop:"question_id",width:"200"}}),e._v(" "),i("bk-table-column",{attrs:{label:"题目内容",prop:"question"}}),e._v(" "),i("bk-table-column",{attrs:{label:"题目类型",prop:"types",width:"200","filtered-value":e.curType,filters:[{text:"单选题",value:"SINGLE"},{text:"多选题",value:"MULTIPLE"},{text:"判断题",value:"JUDGE"},{text:"填空题",value:"COMPLETION"},{text:"简答题",value:"SHORT_ANSWER"}],"filter-method":e.filterType,"filter-placement":"bottom-end","filter-multiple":true},scopedSlots:e._u([{key:"default",fn:function(t){return[i("bk-tag",{attrs:{theme:"info",type:"filled"}},[e._v("\n                        "+e._s(e.questionType(t.row.types))+"\n                    ")])]}}])}),e._v(" "),i("bk-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("bk-button",{attrs:{theme:"primary",text:""},on:{click:function(i){e.deleteQuestion(t.row)}}},[e._v("删除")])]}}])})],1)],1)],1)};var a=[];i.d(t,"a",function(){return n});i.d(t,"b",function(){return a})},198:function(e,t,i){"use strict";var n=function(){var e=this;var t=e.$createElement;var i=e._self._c||t;return i("div",{staticStyle:{display:"inline-block"}},[i("bk-button",{staticStyle:{"margin-left":"5px","margin-bottom":"21px","border-style":"double"},attrs:{theme:"primary",title:"主要按钮",icon:"icon-block-shape"},on:{click:e.chapterManage}},[e._v("\n        章节管理\n    ")]),e._v(" "),i("bk-sideslider",{attrs:{"is-show":e.show,"quick-close":true},on:{"update:isShow":function(t){e.show=t},hidden:e.handleHidden,shown:e.handleShown}},[i("div",{attrs:{slot:"header"},slot:"header"},[e._v("章节管理")]),e._v(" "),i("div",{staticClass:"p20",attrs:{slot:"content"},slot:"content"},[i("bk-form",{ref:"appendChapter",attrs:{model:e.append,"label-width":0}},[i("div",{staticClass:"appendChapter"},[i("bk-form-item",{attrs:{required:true,rules:e.rules.chapter,property:"appendText","icon-offset":135}},[i("bk-input",{ref:"appendInput",staticStyle:{width:"70%"},attrs:{clearable:false},on:{blur:e.handleAppendBlur,enter:e.appendChapter},model:{value:e.append.appendText,callback:function(t){e.$set(e.append,"appendText",t)},expression:"append.appendText"}}),e._v(" "),i("bk-button",{staticClass:"mr10",staticStyle:{float:"right"},attrs:{theme:"primary",title:"主要按钮"},on:{click:e.appendChapter}},[e._v("\n                            新增章节\n                        ")])],1)],1)]),e._v(" "),i("div",{staticClass:"chapters"},[i("bk-table",{attrs:{data:e.chapterList,size:e.size,"outer-border":true,"virtual-render":false,"show-header":false,"highlight-current-row":false,"row-style":e.tableRowStyle,height:"480"},on:{"row-click":e.handleRowClick,"row-dblclick":e.handleRowDbclick,"selection-change":e.handleSelectChange}},[i("bk-table-column",{attrs:{label:"章节",prop:"chapter_name",sortable:"",width:"250"},on:{"row-dblclick":e.handleRowDbclickChapter},scopedSlots:e._u([{key:"default",fn:function(t){return[!e.rowEditable(t.row.id)?i("p",[e._v(e._s(t.row.chapter_name))]):i("bk-input",{ref:"myinput",staticClass:"input",staticStyle:{display:"inline-block"},on:{enter:function(i){e.handleEnter(t.row)},blur:function(i){e.handleBlur(t.row)}},model:{value:t.row.chapter_name,callback:function(i){e.$set(t.row,"chapter_name",i)},expression:"props.row.chapter_name"}})]}}])}),e._v(" "),i("bk-table-column",{attrs:{label:"操作",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("bk-button",{staticClass:"mr10",attrs:{theme:"default",icon:"delete",outline:true,size:"small"},on:{click:function(i){e.deleteChapter(t.row)}}})]}}])})],1)],1),e._v(" "),i("div",{staticClass:"saveChange"},[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",title:"主要按钮"},on:{click:e.saveChange}},[e._v("\n                    保存\n                ")])],1)],1)])],1)};var a=[];i.d(t,"a",function(){return n});i.d(t,"b",function(){return a})},199:function(e,t,i){"use strict";var n=function(){var e=this;var t=e.$createElement;var i=e._self._c||t;return i("div",[i("div",{staticClass:"upload"},[i("bk-upload",{staticStyle:{width:"100%"},attrs:{tip:"只允许上传.xls的文件","with-credentials":true,"custom-request":e.addExcel,"handle-res-code":true,limit:1,accept:".xls"}})],1),e._v(" "),i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:e.downtemplete}},[e._v("下载出题模板")])],1)};var a=[];i.d(t,"a",function(){return n});i.d(t,"b",function(){return a})},83:function(e,t,i){"use strict";i.r(t);var n=i(190);var a=i(115);for(var s in a)if(s!=="default")(function(e){i.d(t,e,function(){return a[e]})})(s);var r=i(175);var o=i(2);var u=Object(o["a"])(a["default"],n["a"],n["b"],false,null,"45cfdfaa",null);t["default"]=u.exports}}]);